from dotenv import load_dotenv
from pydantic import BaseModel
from groq import Groq
import os
from langchain_core.prompts import ChatPromptTemplate 
from langchain_core.output_parsers import PydanticOutputParser
from langchain.agents import create_tool_calling_agent, AgentExecutor

load_dotenv()

class ParagraphResponse(BaseModel):
    paragragh: str
    summary: str
    sources: list[str]
    tools_used: list[str]
    parser = PydanticOutputParser(pydantic_object = ParagraphResponse)

client = Groq(api_key=os.getenv("GROQ_API_KEY"))
chat_completion = client.chat.completions.create(
    messages=[
        {
            "role": "user",
            "content": "WAP to generate a paragraph on the inportance of sex education ",
        }
    ],
    model="openai/gpt-oss-120b",
)
print(print(chat_completion.choices[0].message.content))

prompt = ChatPromptTemplate.from_messages([
    (
        "system",
        """
        You are a research assistant that will help generate a research paragraph.
        Answer the user prompt and use the necessary tools.
        Wrap your response in the following format and provide no other text:\n{format_instructions}""",
        ("placeholder", "{chart_history}"),
        ("human", "{query}"),
        ("placeholder", "{agent_scatchpad}"),

    )
]).partial(format_instructions=ParagraphResponse.parser.get_format_instructions())

agent = create_tool_calling_agent(
    llm = chat_completion,
    prompt = prompt,
    tools = []
)

agent_executor = AgentExecutor(agent=agent, tools=[], verbose=True)
raw_response = agent_executor.invoke({"query": "WAP to generate a paragraph on the importance of sex education."})
print(raw_response)
